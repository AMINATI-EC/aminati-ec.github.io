<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ã­ã³ã°ã­ã£ãOP - AMINATI_EC</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif; 
            background-color: #ffffff; 
            color: #000000; 
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        header { 
            position: fixed; 
            top: 0; 
            left: 0; 
            right: 0; 
            background-color: #ffffff; 
            z-index: 1000; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); 
        }
        .header-content { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 15px 20px; 
            position: relative;
        }
        .menu-btn {
            width: 24px;
            height: 24px;
            position: relative;
            cursor: pointer;
            z-index: 1002;
        }
        .menu-btn span {
            display: block;
            width: 100%;
            height: 2px;
            background-color: #000000;
            position: absolute;
            transition: all 0.3s ease;
        }
        .menu-btn span:nth-child(1) { top: 0; }
        .menu-btn span:nth-child(2) { top: 11px; }
        .menu-btn span:nth-child(3) { bottom: 0; }
        .menu-btn.active span:nth-child(1) {
            transform: rotate(45deg);
            top: 11px;
        }
        .menu-btn.active span:nth-child(2) {
            opacity: 0;
        }
        .menu-btn.active span:nth-child(3) {
            transform: rotate(-45deg);
            bottom: 11px;
        }
        .logo { 
            font-size: 28px; 
            font-weight: 900; 
            letter-spacing: -2px;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }
        .cart-icon {
            width: 24px;
            height: 24px;
            position: relative;
            cursor: pointer;
        }
        
        .slide-menu {
            position: fixed;
            top: 0;
            left: -300px;
            width: 300px;
            height: 100vh;
            background-color: #ffffff;
            z-index: 1001;
            transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 2px 0 20px rgba(0,0,0,0.1);
        }
        .slide-menu.active {
            left: 0;
        }
        .menu-header {
            padding: 30px 20px;
            border-bottom: 1px solid #e0e0e0;
        }
        .menu-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        .menu-subtitle {
            font-size: 12px;
            color: #888888;
        }
        .menu-nav {
            padding: 20px 0;
        }
        .menu-item {
            display: block;
            padding: 15px 20px;
            text-decoration: none;
            color: #000000;
            font-size: 16px;
            font-weight: 500;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .menu-item:hover {
            background-color: #f5f5f5;
            padding-left: 30px;
        }
        .menu-item::after {
            content: 'â';
            position: absolute;
            right: 20px;
            opacity: 0.5;
        }
        .menu-footer {
            position: absolute;
            bottom: 30px;
            left: 20px;
            right: 20px;
        }
        .menu-footer-text {
            font-size: 11px;
            color: #888888;
            line-height: 1.5;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 999;
        }
        .overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        main { 
            margin-top: 64px; 
            flex: 1;
            margin-bottom: 100px;
        }
        
        .product-images { 
            position: relative; 
            width: 100%; 
            background: #f5f5f5; 
        }
        .main-image { 
            width: 100%; 
            height: auto; 
            display: block; 
        }
        .image-carousel { 
            display: flex; 
            overflow-x: auto; 
            gap: 10px; 
            padding: 10px; 
            background: #ffffff;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        .image-carousel::-webkit-scrollbar { display: none; }
        .carousel-item { 
            flex: 0 0 80px; 
            height: 100px; 
            background: #f5f5f5;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer; 
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        .carousel-item.active { border-color: #000000; }
        .carousel-item img { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
        }
        
        .product-details { padding: 20px; }
        .brand-name { 
            font-size: 12px; 
            color: #666666; 
            text-transform: uppercase; 
            letter-spacing: 1px;
            margin-bottom: 8px; 
        }
        .product-name { 
            font-size: 18px; 
            font-weight: 700; 
            line-height: 1.4;
            margin-bottom: 15px; 
        }
        .stock-info { 
            background: #000000; 
            color: #ffffff; 
            padding: 4px 12px; 
            border-radius: 20px; 
            font-size: 11px;
            font-weight: 600;
            display: inline-block; 
            margin-bottom: 15px; 
        }
        .price-section { 
            margin-bottom: 20px; 
            padding-bottom: 20px; 
            border-bottom: 1px solid #e0e0e0; 
        }
        .current-price { 
            font-size: 28px; 
            font-weight: 700; 
            margin-bottom: 5px;
        }
        .original-price { 
            font-size: 16px; 
            color: #999999; 
            text-decoration: line-through; 
            margin-right: 10px; 
        }
        .discount-badge { 
            background: #ff0000; 
            color: #ffffff; 
            padding: 4px 12px; 
            border-radius: 20px; 
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }
        
        .selection-section { margin-bottom: 20px; }
        .section-title { 
            font-size: 14px; 
            font-weight: 600; 
            margin-bottom: 10px; 
        }
        .color-options, .size-options { 
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .option-item {
            padding: 8px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
        }
        .option-item.active {
            background: #000000;
            color: #ffffff;
            border-color: #000000;
        }
        .size-options .option-item {
            min-width: 60px;
            text-align: center;
            border-radius: 8px;
        }
        
        .purchase-section { 
            position: fixed; 
            bottom: 0; 
            left: 0; 
            right: 0; 
            background: #ffffff; 
            padding: 15px 20px 25px; 
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 997;
        }
        .purchase-buttons { 
            display: grid; 
            grid-template-columns: 1fr; 
            gap: 10px; 
        }
        .btn-add-cart { 
            background: #000000; 
            color: #ffffff; 
            padding: 15px; 
            border: none; 
            border-radius: 8px; 
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-add-cart:active { transform: scale(0.98); }
        
        .description-section { 
            padding: 20px; 
            background: #f8f8f8;
            margin-bottom: 20px;
        }
        .description-text { 
            font-size: 14px; 
            line-height: 1.8;
            color: #333333;
        }
        .details-section { 
            padding: 20px; 
            background: #ffffff;
        }
        .detail-item { 
            display: flex; 
            padding: 12px 0; 
            border-bottom: 1px solid #f0f0f0; 
        }
        .detail-item:last-child {
            border-bottom: none;
        }
        .detail-label { 
            flex: 0 0 100px; 
            font-size: 13px; 
            color: #666666; 
        }
        .detail-value { 
            flex: 1; 
            font-size: 13px;
            color: #000000;
        }
    
        
        /* PCçã¬ã¤ã¢ã¦ã */
        @media (min-width: 768px) {
            main {
                display: flex;
                gap: 40px;
                padding: 0 40px;
                max-width: 1200px;
                margin: 0 auto;
                margin-top: 144px;
                margin-bottom: 20px;
                position: relative;
                align-items: flex-start;
            }
            
            .product-images {
                flex: 0 0 50%;
                max-width: 50%;
                margin: 0;
                background: #f5f5f5;
            }
            
            .main-image {
                height: auto;
                min-height: 600px;
                object-fit: cover;
            }
            
            .product-content {
                flex: 1;
                display: flex;
                flex-direction: column;
                min-height: 600px;
                position: relative;
                padding-bottom: 20px;
            }
            
            .product-details {
                padding: 0;
                margin-bottom: 30px;
            }
            
            .brand-name {
                margin-bottom: 15px;
                font-size: 12px;
                color: #666666;
                text-transform: uppercase;
                letter-spacing: 1px;
            }
            
            .product-name {
                font-size: 20px;
                margin-bottom: 20px;
                line-height: 1.4;
                word-wrap: break-word;
                overflow-wrap: break-word;
                white-space: normal;
                max-width: 100%;
            }
            
            .description-section {
                margin: 0 0 20px 0;
                padding: 20px;
                background: #f8f8f8;
            }
            
            .details-section {
                margin: 0;
                padding: 20px;
                background: #ffffff;
                flex-grow: 1;
            }
            
            .purchase-section {
                position: static;
                width: 100%;
                background: #ffffff;
                padding: 20px;
                box-shadow: none;
                border-radius: 0;
                z-index: auto;
                margin-top: 30px;
                margin-bottom: 0;
                border-top: 1px solid #e0e0e0;
            }
            
            @media (max-width: 767px) {
                main {
                    margin-top: 64px !important;
                }
                
                .purchase-section {
                    position: fixed !important;
                    bottom: 0 !important;
                    left: 0 !important;
                    right: 0 !important;
                    width: auto !important;
                    margin-top: 0 !important;
                    border-top: none !important;
                    box-shadow: 0 -2px 10px rgba(0,0,0,0.1) !important;
                }
            }
        }</style>
</head>
<body>
    
    <header>
        <div class="header-content">
            <div class="menu-btn" id="menuBtn">
                <span></span>
                <span></span>
                <span></span>
            </div>
            
            <!-- サイズ詳細表を追加 -->
            <div class="size-chart-section">
                <h3 class="section-title">サイズ詳細</h3>
                <div class="size-table-wrapper">
                    <table class="size-table">
                        <thead>
                            <tr>
                                <th>サイズ</th><th>身幅</th><th>着丈</th><th>総丈</th><th>ゆき</th><th>胸囲</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="size-label">M</td><td>68.75</td><td>67</td><td>69</td><td>43</td><td>137.5</td>
                            </tr>
                            <tr>
                                <td class="size-label">L</td><td>71.25</td><td>69.5</td><td>71.5</td><td>45.5</td><td>140</td>
                            </tr>
                            <tr>
                                <td class="size-label">XL</td><td>73.75</td><td>72</td><td>74</td><td>48</td><td>142.5</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <p class="size-note">
                    ※単位：cm<br>
                    ※平置き採寸のため、多少の誤差はご了承ください。
                </p>
            </div>
            
            <h1 class="logo">AMINATI</h1>
            <div class="cart-icon"></div>
        </div>
    </header>
    
    <div class="slide-menu" id="slideMenu">
        <div class="menu-header">
            <div class="menu-title">MENU</div>
            <div class="menu-subtitle">WHOLESALE CATALOG</div>
        </div>
        <nav class="menu-nav">
            <a href="#" class="menu-item" onclick="goToTopPage(); return false;">ããããã¼ã¸</a>
            <a href="#" class="menu-item" onclick="showAllProducts(); return false;">ãã¹ã¦ã®åå</a>
            <a href="#" class="menu-item" onclick="showNewProducts(); return false;">æ°çåå</a>
            <a href="#" class="menu-item" onclick="showCategories(); return false;">ã«ãã´ãªã¼</a>
            <a href="#" class="menu-item" onclick="showAboutTrade(); return false;">ãåå¼ã«ã¤ãã¦</a>
            <a href="#" class="menu-item" onclick="showCompanyInfo(); return false;">ä¼ç¤¾æ¦è¦</a>
            <a href="#" class="menu-item" onclick="showContact(); return false;">ãåãåãã</a>
        </nav>
        <div class="menu-footer">
            <p class="menu-footer-text">
                å¶æ¥­æé: å¹³æ¥ 9:00-18:00<br>
                TEL: 03-XXXX-XXXX<br>
                FAX: 03-XXXX-XXXX
            </p>
        </div>
    </div>

    <div class="overlay" id="overlay"></div>
    
    <main>
        
        
        <div class="product-images">
            <img src="https://pub-a2319224352d4abda31352be3c2b1c19.r2.dev/products/5117-5001-thumb.jpg" alt="ååç»å" class="main-image" id="mainImage">
            
            <div class="image-carousel">
                <div class="carousel-item active" onclick="changeImage('https://pub-a2319224352d4abda31352be3c2b1c19.r2.dev/products/5117-5001-thumb.jpg', this)">
                    <img src="https://pub-a2319224352d4abda31352be3c2b1c19.r2.dev/products/5117-5001-thumb.jpg" alt="ã¡ã¤ã³ç»å">
                </div>
                
                <div class="carousel-item" onclick="changeImage('https://pub-a2319224352d4abda31352be3c2b1c19.r2.dev/products/5117-5001-detail-1.jpg', this)">
                    <img src="https://pub-a2319224352d4abda31352be3c2b1c19.r2.dev/products/5117-5001-detail-1.jpg" alt="ç»å2">
                </div>
                
                <div class="carousel-item" onclick="changeImage('https://pub-a2319224352d4abda31352be3c2b1c19.r2.dev/products/5117-5001-detail-2.jpg', this)">
                    <img src="https://pub-a2319224352d4abda31352be3c2b1c19.r2.dev/products/5117-5001-detail-2.jpg" alt="ç»å3">
                </div>
                
                <div class="carousel-item" onclick="changeImage('https://pub-a2319224352d4abda31352be3c2b1c19.r2.dev/products/5117-5001-detail-3.jpg', this)">
                    <img src="https://pub-a2319224352d4abda31352be3c2b1c19.r2.dev/products/5117-5001-detail-3.jpg" alt="ç»å4">
                </div>
                
            </div>
            
        </div>
        
        <div class="product-content">
        <div class="product-details">
            <div class="brand-name">MYK FASHION</div>
            <h2 class="product-name">ã­ã³ã°ã­ã£ãOP</h2>
            
            
            
            <div class="price-section">
                <div class="current-price" >Â¥10500</div>
                
            </div>

            
            <div class="selection-section">
                <h3 class="section-title">ã«ã©ã¼</h3>
                <div class="color-options">
                    
                    <div class="option-item color-option active" data-value="09 BLACK 54 BROWN 85 BLUE">09 BLACK 54 BROWN 85 BLUE</div>
                    
                </div>
            </div>
            

            
            <div class="selection-section">
                <h3 class="section-title">ãµã¤ãº</h3>
                <div class="size-options">
                    
                    <div class="option-item size-option active" data-value="F">F</div>
                    
                </div>
            </div>
            
        </div>
        
        <div class="description-section">
            <h3 class="section-title">ååèª¬æ</h3>
            <p class="description-text">ã­ã³ã°ã­ã£ãOPã¯ãMYK FASHIONã®äººæ°ã¢ã¤ãã ã§ãã<br>ç´ æã«ã¯è¡¨å°ï¼ï¾ï¾ï¾ï½´ï½½ï¾ï¾72ï¼ ç¶¿28ï¼ è£å°ï¼ï¾ï¾ï¾ï½´ï½½ï¾ï¾100ï¼ãä½¿ç¨ããåè³ªã«ãã ãã£ã¦è£½ä½ããã¦ãã¾ãã<br>ãµã¤ãºã¯Fããç¨æãã¦ãã¾ãã<br>ãã²ãã®æ©ä¼ã«ãè²·ãæ±ããã ããã</p>
        </div>
        
        <div class="details-section">
            <h3 class="section-title">ååè©³ç´°</h3>
            <div class="detail-item">
                <span class="detail-label">ç´ æ</span>
                <span class="detail-value">è¡¨å°ï¼ï¾ï¾ï¾ï½´ï½½ï¾ï¾72ï¼ ç¶¿28ï¼ è£å°ï¼ï¾ï¾ï¾ï½´ï½½ï¾ï¾100ï¼</span>
            </div>
            <div class="detail-item">
                <span class="detail-label">åç£å½</span>
                <span class="detail-value">ä¸­å½</span>
            </div>
            <div class="detail-item">
                <span class="detail-label">åçª</span>
                <span class="detail-value">5117-5001</span>
            </div>
            <div class="detail-item">
                <span class="detail-label">æ§å¥ã¿ã¤ã</span>
                <span class="detail-value">ã¡ã³ãºã»ã¬ãã£ã¼ã¹</span>
            </div>
        </div>
    
        
        </div>
    </main>
    
    
    <div class="purchase-section">
        <div class="purchase-buttons">
            <button class="btn-add-cart" onclick="startPurchaseFlow()">æ³¨æããï¼ä»£å¼ãã®ã¿ï¼</button>
        </div>
    </div>
    
<script>
    
        // AdminSettings ã°ã­ã¼ãã«ãªãã¸ã§ã¯ãã®ç¢ºèª
        if (typeof window.adminSettings === 'undefined') {
            console.warn('AdminSettings ãè¦ã¤ããã¾ãããããã©ã«ãè¨­å®ãä½¿ç¨ãã¾ãã');
        }
          // â ãããåé¤ãããã
    
        // ã¡ãã¥ã¼ã®éé
        const menuBtn = document.getElementById('menuBtn');
        const slideMenu = document.getElementById('slideMenu');
        const overlay = document.getElementById('overlay');

        menuBtn.addEventListener('click', function() {
            menuBtn.classList.toggle('active');
            slideMenu.classList.toggle('active');
            overlay.classList.toggle('active');
        });

        overlay.addEventListener('click', function() {
            menuBtn.classList.remove('active');
            slideMenu.classList.remove('active');
            overlay.classList.remove('active');
        });
        
        // ã¡ãã¥ã¼é ç®ã®å¦çï¼ç¸å¯¾ãã¹ãä½¿ç¨ï¼
        function goToTopPage() {
            window.location.href = '../index.html';
        }
        
        function showAllProducts() {
            window.location.href = '../index.html';
        }
        
        function showNewProducts() {
            window.location.href = '../index.html#new';
        }
        
        function showCategories() {
            window.location.href = '../index.html#categories';
        }
        
        function showAboutTrade() {
            window.location.href = '../trade.html';
        }
        
        function showCompanyInfo() {
            window.location.href = '../company.html';
        }
        
        function showContact() {
            window.location.href = '../contact.html';
        }
        
        // ç»ååãæ¿ã
        function changeImage(src, element) {
            document.getElementById('mainImage').src = src;
            document.querySelectorAll('.carousel-item').forEach(item => {
                item.classList.remove('active');
            });
            element.classList.add('active');
        }
        
        // ãªãã·ã§ã³é¸æ
        document.querySelectorAll('.option-item').forEach(option => {
            option.addEventListener('click', function() {
                const siblings = this.parentElement.querySelectorAll('.option-item');
                siblings.forEach(item => item.classList.remove('active'));
                this.classList.add('active');
            });
        });
        
        // ååãã¼ã¿
        const currentProduct = {
            productNumber: '5117-5001',
            productName: 'ã­ã³ã°ã­ã£ãOP',
            brandName: 'MYK FASHION',
            price: 10500,
            originalPrice: 10500,
            material: 'è¡¨å°ï¼ï¾ï¾ï¾ï½´ï½½ï¾ï¾72ï¼ ç¶¿28ï¼ è£å°ï¼ï¾ï¾ï¾ï½´ï½½ï¾ï¾100ï¼',
            origin: 'ä¸­å½',
            colors: ["09 BLACK 54 BROWN 85 BLUE"],
            sizes: ["F"],
            thumbnail: 'https://pub-a2319224352d4abda31352be3c2b1c19.r2.dev/products/5117-5001-thumb.jpg'
        };
        
        // æ°å¤ãã©ã¼ããã
        function formatNumber(num) {
            return num.toLocaleString('ja-JP');
        }
    
        // EmailNotificationServiceï¼Google Apps Scriptçï¼
        class EmailNotificationService {
            constructor() {
                this.apiUrl = 'https://script.google.com/macros/s/AKfycbw8XWKX56Kioxp0xJH2Vc5qiWDv-Y-XlIQzQ5LkJCbDoEEoIwx_-92gHFjj3MHFnQvO/exec';
            }
            
            async sendOrderNotification(orderData) {
                try {
                    console.log('ð§ ã¡ã¼ã«éä¿¡éå§...', orderData);
                    
                    // Adminè¨­å®ããã¡ã¼ã«ã¢ãã¬ã¹ãåå¾
                    let adminEmail = this.getAdminEmail();
                    
                    // ç®¡çèã¡ã¼ã«ã¢ãã¬ã¹ãåå¾ã§ããªãå ´åã¯ããã©ã«ããä½¿ç¨
                    if (!adminEmail) {
                        console.warn('â ï¸ ç®¡çèã¡ã¼ã«ã¢ãã¬ã¹ãè¨­å®ããã¦ããªããããããã©ã«ãã¢ãã¬ã¹ãä½¿ç¨ãã¾ã');
                        adminEmail = 'aminati.ec@gmail.com';
                    }
                    
                    // APIã«éä¿¡ãããã¼ã¿å½¢å¼ã«å¤æ
                    const emailData = this.formatEmailData(orderData, adminEmail);
                    
                    console.log('ð GASå¼ã³åºã:', this.apiUrl);
                    console.log('ð éä¿¡ãã¼ã¿:', emailData);
                    
                    // Google Apps Script ãå¼ã³åºã
                    const response = await fetch(this.apiUrl, {
                        method: 'POST',
                        mode: 'no-cors', // CORSåé¿
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(emailData)
                    });
                    
                    // no-corsã¢ã¼ãã§ã¯responseã®ä¸­èº«ãè¦ããªããããæåã¨ä»®å®
                    console.log('â GASå¼ã³åºãå®äºï¼no-corsã¢ã¼ãï¼');
                    
                    // ã·ã³ãã«ãªæåéç¥
                    alert('ã¡ã¼ã«éä¿¡ãªã¯ã¨ã¹ããéä¿¡ãã¾ããï¼');
                    
                    return { success: true };
                    
                } catch (error) {
                    console.error('â ã¡ã¼ã«éä¿¡ã¨ã©ã¼:', error);
                    alert('ã¡ã¼ã«éä¿¡ä¸­ã«ã¨ã©ã¼ãçºçãã¾ãã: ' + error.message);
                    return { success: false, error: error.message };
                }
            }
            
            // ç®¡çèã¡ã¼ã«ã¢ãã¬ã¹ãåå¾
            getAdminEmail() {
                if (window.adminSettings && typeof window.adminSettings.get === 'function') {
                    try {
                        const email = window.adminSettings.get('email');
                        if (email && email.trim() !== '') {
                            console.log('â AdminSettingsèª­ã¿è¾¼ã¿æå: ' + email);
                            return email;
                        }
                    } catch (e) {
                        console.warn('â ï¸ AdminSettings.get()ã¨ã©ã¼:', e);
                    }
                }
                
                console.warn('â ï¸ ç®¡çèã¡ã¼ã«ã¢ãã¬ã¹ãæªè¨­å®ãããã©ã«ããä½¿ç¨');
                return null;
            }
            
            formatEmailData(orderData, adminEmail) {
                return {
                    orderId: orderData.orderId,
                    orderDate: orderData.orderDate,
                    adminEmail: adminEmail,
                    product: {
                        productNumber: orderData.product.productNumber,
                        productName: orderData.product.productName,
                        brandName: orderData.product.brandName || 'AMINATI COLLECTION',
                        selectedColor: orderData.product.selectedColor || '',
                        selectedSize: orderData.product.selectedSize || '',
                        price: orderData.product.price
                    },
                    pricing: {
                        productPrice: orderData.pricing.productPrice,
                        shippingFee: orderData.pricing.shippingFee,
                        codFee: orderData.pricing.codFee,
                        totalPrice: orderData.pricing.totalPrice
                    },
                    customer: {
                        name: orderData.customer.name,
                        kana: orderData.customer.kana || '',
                        phone: orderData.customer.phone,
                        email: orderData.customer.email || '',
                        zip: orderData.customer.zip,
                        address: orderData.customer.address
                    },
                    delivery: {
                        date: orderData.delivery.date || '',
                        time: orderData.delivery.time || '',
                        note: orderData.delivery.note || ''
                    }
                };
            }
        }
        
        // ã°ã­ã¼ãã«ã¤ã³ã¹ã¿ã³ã¹ä½æ
        const emailNotificationService = new EmailNotificationService();
        
        // æ¢å­ã®ã³ã¼ãã¨ã®äºææ§ãä¿ã¤ããã®ã©ããã¼é¢æ°
        function sendOrderNotification(orderData) {
            return emailNotificationService.sendOrderNotification(orderData);
        }
        
        // è³¼å¥ãã­ã¼éå§
        function startPurchaseFlow() {
            const selectedColor = document.querySelector('.color-option.active')?.dataset.value || '';
            const selectedSize = document.querySelector('.size-option.active')?.dataset.value || '';
            
            const purchaseData = {
                ...currentProduct,
                selectedColor: selectedColor,
                selectedSize: selectedSize,
                timestamp: new Date().toISOString()
            };
            
            sessionStorage.setItem('purchaseData', JSON.stringify(purchaseData));
            showEstimateModal(purchaseData);
        }
        
        // æ¦ç®ç¢ºèªã¢ã¼ãã«
        function showEstimateModal(purchaseData) {
            const shippingFee = 500;
            const codFee = 330;
            const totalPrice = purchaseData.price + shippingFee + codFee;
            
            const modalHtml = `
                <div class="modal-overlay" id="estimateModal">
                    <div class="modal-content">
                        <h2>ãæ³¨æåå®¹ã®ç¢ºèª</h2>
                        
                        <div class="order-summary">
                            <div class="product-info">
                                <h3>${purchaseData.productName}</h3>
                                <p>ãã©ã³ã: ${purchaseData.brandName}</p>
                                <p>ã«ã©ã¼: ${purchaseData.selectedColor}</p>
                                <p>ãµã¤ãº: ${purchaseData.selectedSize}</p>
                            </div>
                            
                            <div class="price-breakdown">
                                <div class="price-item">
                                    <span>ååä»£é</span>
                                    <span>Â¥${formatNumber(purchaseData.price)}</span>
                                </div>
                                <div class="price-item">
                                    <span>ééæ</span>
                                    <span>Â¥${formatNumber(shippingFee)}</span>
                                </div>
                                <div class="price-item">
                                    <span>ä»£å¼ãææ°æ</span>
                                    <span>Â¥${formatNumber(codFee)}</span>
                                </div>
                                <div class="price-total">
                                    <span>åè¨éé¡</span>
                                    <span>Â¥${formatNumber(totalPrice)}</span>
                                </div>
                            </div>
                            
                            <div class="payment-info">
                                <p><strong>ãæ¯æãæ¹æ³:</strong> ä»£éå¼æï¼ç¾éã®ã¿ï¼</p>
                                <p><small>â»ååå°çæã«ééå¡ã«ãæ¯æããã ãã</small></p>
                            </div>
                        </div>
                        
                        <div class="modal-buttons">
                            <button class="btn-secondary" onclick="closeEstimateModal()">æ»ã</button>
                            <button class="btn-primary" onclick="proceedToShipping()">ãã®åå®¹ã§æ³¨æãã</button>
                        </div>
                    </div>
                </div>
                
                <style>
                .modal-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0,0,0,0.8);
                    z-index: 2000;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    padding: 20px;
                }
                .modal-content {
                    background: white;
                    border-radius: 12px;
                    padding: 30px;
                    max-width: 400px;
                    width: 100%;
                    max-height: 80vh;
                    overflow-y: auto;
                }
                .modal-content h2 {
                    font-size: 20px;
                    margin-bottom: 20px;
                    text-align: center;
                }
                .order-summary {
                    margin-bottom: 25px;
                }
                .product-info {
                    padding: 15px;
                    background: #f8f8f8;
                    border-radius: 8px;
                    margin-bottom: 20px;
                }
                .product-info h3 {
                    font-size: 16px;
                    margin-bottom: 10px;
                }
                .product-info p {
                    font-size: 14px;
                    color: #666;
                    margin-bottom: 5px;
                }
                .price-breakdown {
                    border: 1px solid #e0e0e0;
                    border-radius: 8px;
                    padding: 15px;
                    margin-bottom: 15px;
                }
                .price-item {
                    display: flex;
                    justify-content: space-between;
                    margin-bottom: 10px;
                    font-size: 14px;
                }
                .price-total {
                    display: flex;
                    justify-content: space-between;
                    font-weight: bold;
                    font-size: 16px;
                    padding-top: 10px;
                    border-top: 1px solid #e0e0e0;
                    margin-top: 10px;
                }
                .payment-info {
                    background: #fff3cd;
                    padding: 15px;
                    border-radius: 8px;
                    border: 1px solid #ffeaa7;
                }
                .payment-info p {
                    margin-bottom: 5px;
                    font-size: 14px;
                }
                .modal-buttons {
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 15px;
                    margin-top: 20px;
                }
                .btn-primary, .btn-secondary {
                    padding: 12px 20px;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.3s ease;
                }
                .btn-primary {
                    background: #000;
                    color: white;
                }
                .btn-secondary {
                    background: #f5f5f5;
                    color: #333;
                }
                .btn-primary:hover {
                    background: #333;
                }
                .btn-secondary:hover {
                    background: #e0e0e0;
                }
                </style>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            const estimateData = {
                ...purchaseData,
                shippingFee: shippingFee,
                codFee: codFee,
                totalPrice: totalPrice
            };
            sessionStorage.setItem('estimateData', JSON.stringify(estimateData));
        }
        
        function closeEstimateModal() {
            const modal = document.getElementById('estimateModal');
            if (modal) modal.remove();
        }
        
        function proceedToShipping() {
            closeEstimateModal();
            showShippingForm();
        }
        
        // ééåå¥åãã©ã¼ã 
        function showShippingForm() {
            const modalHtml = `
                <div class="modal-overlay" id="shippingModal">
                    <div class="modal-content shipping-form">
                        <h2>ééåæå ±ã®å¥å</h2>
                        
                        <form id="shippingForm">
                            <div class="form-group">
                                <label for="customerName">ãåå <span class="required">*</span></label>
                                <input type="text" id="customerName" name="customerName" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="customerKana">ãååï¼ããªã¬ãï¼ <span class="required">*</span></label>
                                <input type="text" id="customerKana" name="customerKana" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="customerPhone">é»è©±çªå· <span class="required">*</span></label>
                                <input type="tel" id="customerPhone" name="customerPhone" required placeholder="ä¾: 090-1234-5678">
                            </div>
                            
                            <div class="form-group">
                                <label for="customerEmail">ã¡ã¼ã«ã¢ãã¬ã¹</label>
                                <input type="email" id="customerEmail" name="customerEmail" placeholder="ä¾: example@email.com">
                            </div>
                            
                            <div class="form-group">
                                <label for="customerZip">éµä¾¿çªå· <span class="required">*</span></label>
                                <input type="text" id="customerZip" name="customerZip" required placeholder="ä¾: 123-4567">
                            </div>
                            
                            <div class="form-group">
                                <label for="customerAddress">ä½æ <span class="required">*</span></label>
                                <textarea id="customerAddress" name="customerAddress" required placeholder="é½éåºçå¸åºçºæçªå°"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="deliveryDate">å¸æééæ¥</label>
                                <input type="date" id="deliveryDate" name="deliveryDate">
                                <small>â»æç­5æ¥å¾ããæå®å¯è½</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="deliveryTime">å¸æééæé</label>
                                <select id="deliveryTime" name="deliveryTime">
                                    <option value="">æå®ãªã</option>
                                    <option value="ååä¸­">ååä¸­</option>
                                    <option value="12-14">12:00-14:00</option>
                                    <option value="14-16">14:00-16:00</option>
                                    <option value="16-18">16:00-18:00</option>
                                    <option value="18-20">18:00-20:00</option>
                                    <option value="19-21">19:00-21:00</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="orderNote">ãè¦æã»åè</label>
                                <textarea id="orderNote" name="orderNote" placeholder="ãã®ä»ãè¦æããããã¾ããããè¨å¥ãã ãã"></textarea>
                            </div>
                        </form>
                        
                        <div class="modal-buttons">
                            <button class="btn-secondary" onclick="closeShippingModal()">æ»ã</button>
                            <button class="btn-primary" onclick="submitOrder()">æ³¨æãç¢ºå®ãã</button>
                        </div>
                    </div>
                </div>
                
                <style>
                .shipping-form {
                    max-width: 500px;
                    max-height: 90vh;
                }
                .form-group {
                    margin-bottom: 20px;
                }
                .form-group label {
                    display: block;
                    margin-bottom: 5px;
                    font-weight: 600;
                    font-size: 14px;
                }
                .required {
                    color: #ff0000;
                }
                .form-group input,
                .form-group select,
                .form-group textarea {
                    width: 100%;
                    padding: 10px;
                    border: 1px solid #ddd;
                    border-radius: 6px;
                    font-size: 14px;
                }
                .form-group textarea {
                    min-height: 80px;
                    resize: vertical;
                }
                .form-group small {
                    display: block;
                    margin-top: 5px;
                    color: #666;
                    font-size: 12px;
                }
                </style>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            const today = new Date();
            const minDate = new Date(today.getTime() + (5 * 24 * 60 * 60 * 1000));
            document.getElementById('deliveryDate').min = minDate.toISOString().split('T')[0];
        }
        
        function closeShippingModal() {
            const modal = document.getElementById('shippingModal');
            if (modal) modal.remove();
        }
        
        function submitOrder() {
            const form = document.getElementById('shippingForm');
            const formData = new FormData(form);
            
            const requiredFields = ['customerName', 'customerKana', 'customerPhone', 'customerZip', 'customerAddress'];
            let isValid = true;
            
            requiredFields.forEach(field => {
                const value = formData.get(field);
                if (!value || value.trim() === '') {
                    isValid = false;
                    document.getElementById(field).style.borderColor = '#ff0000';
                } else {
                    document.getElementById(field).style.borderColor = '#ddd';
                }
            });
            
            if (!isValid) {
                alert('å¿é é ç®ããã¹ã¦å¥åãã¦ãã ããã');
                return;
            }
            
            const estimateData = JSON.parse(sessionStorage.getItem('estimateData'));
            const orderData = {
                orderId: 'ORD-' + Date.now(),
                orderDate: new Date().toISOString(),
                product: {
                    productNumber: estimateData.productNumber,
                    productName: estimateData.productName,
                    brandName: estimateData.brandName,
                    selectedColor: estimateData.selectedColor,
                    selectedSize: estimateData.selectedSize,
                    price: estimateData.price,
                    thumbnail: estimateData.thumbnail
                },
                pricing: {
                    productPrice: estimateData.price,
                    shippingFee: estimateData.shippingFee,
                    codFee: estimateData.codFee,
                    totalPrice: estimateData.totalPrice
                },
                customer: {
                    name: formData.get('customerName'),
                    kana: formData.get('customerKana'),
                    phone: formData.get('customerPhone'),
                    email: formData.get('customerEmail') || '',
                    zip: formData.get('customerZip'),
                    address: formData.get('customerAddress')
                },
                delivery: {
                    date: formData.get('deliveryDate') || '',
                    time: formData.get('deliveryTime') || '',
                    note: formData.get('orderNote') || ''
                },
                status: 'pending'
            };
            
            saveOrder(orderData);
        }
        
        function saveOrder(orderData) {
            // GitHub Pagesçï¼IndexedDBã¯ä½¿ç¨ãããã¡ã¼ã«éç¥ã®ã¿
            console.log('æ³¨æãã¼ã¿:', orderData);
            
            // ã¡ã¼ã«éç¥éä¿¡
            sendOrderNotification(orderData);
            
            // æ³¨æå®äºç»é¢ãè¡¨ç¤º
            showOrderComplete(orderData);
            sessionStorage.removeItem('purchaseData');
            sessionStorage.removeItem('estimateData');
            
            // æ³¨ï¼å®éã®æ³¨æãã¼ã¿ã¯ã¡ã¼ã«ã§ç®¡çèã«éä¿¡ããã¾ã
            // ããé«åº¦ãªæ³¨æç®¡çãå¿è¦ãªå ´åã¯ãããã¯ã¨ã³ããµã¼ãã¼ã®å®è£ãå¿è¦ã§ã
        }
        
        function showOrderComplete(orderData) {
            closeShippingModal();
            
            const modalHtml = `
                <div class="modal-overlay" id="completeModal">
                    <div class="modal-content">
                        <div class="complete-icon">â</div>
                        <h2>ãæ³¨æãããã¨ããããã¾ãã</h2>
                        
                        <div class="order-info">
                            <p><strong>æ³¨æçªå·:</strong> ${orderData.orderId}</p>
                            <p><strong>æ³¨ææ¥æ:</strong> ${new Date(orderData.orderDate).toLocaleString('ja-JP')}</p>
                            <p><strong>åè¨éé¡:</strong> Â¥${formatNumber(orderData.pricing.totalPrice)}</p>
                        </div>
                        
                        <div class="complete-message">
                            <p>ãæ³¨æãæ¿ãã¾ããã</p>
                            <p>ååã¯ä»£éå¼æã§ãå±ããããã¾ãã</p>
                            <p>ééã«ã¤ãã¦è©³ç´°ããé»è©±ã«ã¦ãé£çµ¡ããå ´åããããã¾ãã</p>
                        </div>
                        
                        <div class="modal-buttons">
                            <button class="btn-primary" onclick="closeCompleteModal()">éãã</button>
                        </div>
                    </div>
                </div>
                
                <style>
                .complete-icon {
                    width: 60px;
                    height: 60px;
                    background: #28a745;
                    color: white;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 30px;
                    font-weight: bold;
                    margin: 0 auto 20px;
                }
                .order-info {
                    background: #f8f9fa;
                    padding: 15px;
                    border-radius: 8px;
                    margin: 20px 0;
                }
                .order-info p {
                    margin-bottom: 8px;
                    font-size: 14px;
                }
                .complete-message {
                    text-align: center;
                    margin: 20px 0;
                }
                .complete-message p {
                    margin-bottom: 10px;
                    font-size: 14px;
                    line-height: 1.5;
                }
                </style>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }
        
        function closeCompleteModal() {
            const modal = document.getElementById('completeModal');
            if (modal) modal.remove();
        }
</script>
</body>
</html>